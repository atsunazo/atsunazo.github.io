<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>謎解きタイムアタック</title>
    <style>
        input[type="text"] {
           font-size: 5px;
        }

        body {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        #quiz-container {
            background-color: white;
            max-width: 95%;
            width: 340px;
            margin: 0 auto;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        #question-image {
            width: 315px;
            height: 222px;
            object-fit: cover;
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }

        #result-message {
            font-weight: bold;
            margin-top: 10px;
        }

        .rank {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }

        .incorrect {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="quiz-container">
        <h1>謎解きタイムアタック</h1>
        <div id="start-screen">
            <input type="text" id="name-input" placeholder="名前を入力してください">
            <button id="start-btn">開始</button>
        </div>
        <div id="quiz-screen" style="display: none;">
            <div id="timer">残り時間: 10:00</div>
            <div id="quiz-area">
                <img id="question-image" src="" alt="問題画像">
            </div>
            <input type="text" id="answer-input" placeholder="回答を入力">
            <button id="submit-btn">送信</button>
            <button id="back-btn">戻る</button>
            <p id="result-message"></p>
        </div>
        <div id="finish-screen" style="display: none;">
            <p id="finish-result"></p>
            <button id="restart-btn">もう一度プレイ</button>
        </div>
    </div>

    <script>
        window.addEventListener('resize', function() {
            if (document.activeElement.tagName === 'INPUT') {
                window.setTimeout(function() {
                    document.activeElement.scrollIntoView();
                }, 0);
            }
        });

        const questions = [
            { image: './1.png', answer: 'きのこ' },
            { image: './2.png', answer: 'あいす' },
            { image: './3.png', answer: 'だむ' },
            { image: './4.png', answer: 'まえば' },
            { image: './5.png', answer: 'からす' },
            { image: './6.png', answer: 'よもぎ' },
            { image: './7.png', answer: 'うに' },
            { image: './8.png', answer: 'しりとり' },
        ];

        let currentQuestion = 0;
        let startTime;
        let timerInterval;
        let answers = [];
        let solvedQuestions = new Set();
        let playerName = '';
        let remainingTime = 600; // 10分 = 600秒

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const finishScreen = document.getElementById('finish-screen');
        const nameInput = document.getElementById('name-input');
        const startBtn = document.getElementById('start-btn');
        const quizArea = document.getElementById('quiz-area');
        const questionImage = document.getElementById('question-image');
        const answerInput = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const backBtn = document.getElementById('back-btn');
        const resultMessage = document.getElementById('result-message');
        const timerDisplay = document.getElementById('timer');
        const finishResult = document.getElementById('finish-result');
        const restartBtn = document.getElementById('restart-btn');

        startBtn.addEventListener('click', () => {
            playerName = nameInput.value.trim();
            if (playerName) {
                startScreen.style.display = 'none';
                quizScreen.style.display = 'block';
                startQuiz();
            } else {
                alert('名前を入力してください。');
            }
        });

        function startQuiz() {
            startTime = new Date().getTime();
            timerInterval = setInterval(updateTimer, 1000);
            showQuestion(currentQuestion);
        }

        function showQuestion(index) {
            const question = questions[index];
            questionImage.src = question.image;
            
            if (solvedQuestions.has(index)) {
                answerInput.value = answers[index];
                answerInput.disabled = true;
                resultMessage.textContent = '正解済み';
                resultMessage.className = '';
            } else {
                answerInput.value = '';
                answerInput.disabled = false;
                resultMessage.textContent = '';
                resultMessage.className = '';
            }
        }

        function updateTimer() {
            remainingTime--;
            if (remainingTime <= 0) {
                clearInterval(timerInterval);
                finishQuiz();
            } else {
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                timerDisplay.textContent = `残り時間: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        submitBtn.addEventListener('click', () => {
            const userAnswer = answerInput.value.trim();
            if (userAnswer === questions[currentQuestion].answer) {
                answers[currentQuestion] = userAnswer;
                solvedQuestions.add(currentQuestion);
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    showQuestion(currentQuestion);
                } else {
                    finishQuiz();
                }
            } else {
                resultMessage.textContent = '不正解';
                resultMessage.className = 'incorrect';
            }
        });

        backBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        });

        function getRank(time) {
            const elapsedSeconds = 600 - time; // 経過時間を秒単位で計算
            
            if (elapsedSeconds <= 120) return 'S';
            if (elapsedSeconds <= 240) return 'A';
            if (elapsedSeconds <= 360) return 'B';
            if (elapsedSeconds <= 480) return 'C';
            return 'D';
        }

        function finishQuiz() {
            clearInterval(timerInterval);
            const elapsedTime = 600 - remainingTime; // 経過時間を計算
            const minutes = Math.floor(elapsedTime / 60);
            const seconds = elapsedTime % 60;
            const finalTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const rank = getRank(remainingTime);
            
            quizScreen.style.display = 'none';
            finishScreen.style.display = 'block';
            finishResult.innerHTML = `
                <p>名前: ${playerName}</p>
                <p>タイム: ${finalTime}</p>
                <p class="rank">ランク: ${rank}</p>
            `;
        }

        restartBtn.addEventListener('click', resetQuiz);

        function resetQuiz() {
            currentQuestion = 0;
            answers = [];
            solvedQuestions.clear();
            remainingTime = 600;
            finishScreen.style.display = 'none';
            startScreen.style.display = 'block';
        }
    </script>
</body>
</html>
